# Accessibility Review Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Audit all components and pages for WCAG 2.1 AA violations, fix every finding, and wire up automated regression tests to prevent regressions.

**Architecture:** Bottom-up approach — fix shared DesignSystem components first (max leverage), then layout/navigation, then all 63 pages. Automated regression via axe-core in Vitest unit tests + @axe-core/playwright in E2E tests.

**Tech Stack:** Vue 3 + Nuxt 3, Vitest + `@vue/test-utils`, happy-dom, axe-core, @axe-core/playwright, Playwright

**Reference Design:** `docs/plans/2026-02-19-a11y-review-design.md`

---

## Phase 0: Axe Test Infrastructure

### Task 1: Add axe helper for Vitest

**Files:**
- Create: `tests/unit/helpers/axe.ts`

**Step 1: Write the helper**

```typescript
// tests/unit/helpers/axe.ts
import { run as axeRun, type AxeResults } from 'axe-core'

export async function checkA11y(element: Element): Promise<void> {
  const results: AxeResults = await axeRun(element, {
    runOnly: { type: 'tag', values: ['wcag2a', 'wcag2aa', 'best-practice'] },
  })
  if (results.violations.length > 0) {
    const messages = results.violations.map(
      (v) => `[${v.impact}] ${v.id}: ${v.description}\n  ${v.nodes.map((n) => n.html).join('\n  ')}`
    )
    throw new Error(`A11y violations found:\n${messages.join('\n\n')}`)
  }
}
```

**Step 2: Verify axe-core is importable**

Run: `npm test -- --reporter=verbose tests/unit/helpers/axe.ts 2>&1 | head -20`
Expected: No import errors (file is a helper, not a spec — ignore "no tests" warning)

**Step 3: Commit**

```bash
git add tests/unit/helpers/axe.ts
git commit -m "test: add axe-core helper for Vitest a11y assertions"
```

---

### Task 2: Add axe helper for Playwright E2E

**Files:**
- Create: `tests/e2e/helpers/a11y.ts`

**Step 1: Write the helper**

```typescript
// tests/e2e/helpers/a11y.ts
import { Page } from '@playwright/test'
import { checkA11y as axeCheckA11y, injectAxe } from 'axe-playwright'

export async function checkPageA11y(page: Page, selector = 'body'): Promise<void> {
  await injectAxe(page)
  await axeCheckA11y(page, selector, {
    axeOptions: {
      runOnly: { type: 'tag', values: ['wcag2a', 'wcag2aa', 'best-practice'] },
    },
  })
}
```

**Step 2: Install axe-playwright**

Run: `npm install --save-dev axe-playwright`

**Step 3: Commit**

```bash
git add tests/e2e/helpers/a11y.ts package.json package-lock.json
git commit -m "test: add axe-playwright helper for E2E a11y assertions"
```

---

## Phase 1: DesignSystem Components — Audit + Fix

> Use `a11y-wcag-auditor` agent on each component. Check: semantic HTML, ARIA roles/labels, keyboard nav, focus visibility, color contrast cues. Fix all findings. Then write axe unit test. Commit per component.

### Task 3: DesignSystem/Button.vue

**Files:**
- Audit + fix: `components/DesignSystem/Button.vue`
- Test: `tests/unit/components/DesignSystem/Button.a11y.spec.ts`

**Step 1: Read the component**

Read `components/DesignSystem/Button.vue` in full.

**Step 2: Run a11y-wcag-auditor agent**

Invoke `a11y-wcag-auditor` agent on the file. Check for:
- `disabled` buttons must still be focusable or have `aria-disabled`
- Icon-only variants need `aria-label`
- Loading state needs `aria-busy` and descriptive text
- Focus ring must be visible (not `outline: none` without replacement)

**Step 3: Write failing axe test first**

```typescript
// tests/unit/components/DesignSystem/Button.a11y.spec.ts
import { describe, it } from 'vitest'
import { mount } from '@vue/test-utils'
import Button from '~/components/DesignSystem/Button.vue'
import { checkA11y } from '~/tests/unit/helpers/axe'

describe('Button a11y', () => {
  it('default button has no violations', async () => {
    const wrapper = mount(Button, {
      props: { label: 'Save Changes' },
    })
    await checkA11y(wrapper.element)
  })

  it('disabled button has no violations', async () => {
    const wrapper = mount(Button, {
      props: { label: 'Save Changes', disabled: true },
    })
    await checkA11y(wrapper.element)
  })

  it('icon-only button has no violations', async () => {
    const wrapper = mount(Button, {
      props: { label: 'Delete item', iconOnly: true },
    })
    await checkA11y(wrapper.element)
  })
})
```

**Step 4: Run tests — verify they fail**

Run: `npm test -- tests/unit/components/DesignSystem/Button.a11y.spec.ts`
Expected: FAIL (or PASS if component already clean — proceed either way)

**Step 5: Apply fixes from audit**

Edit `components/DesignSystem/Button.vue` with all findings from Step 2.

**Step 6: Run tests — verify they pass**

Run: `npm test -- tests/unit/components/DesignSystem/Button.a11y.spec.ts`
Expected: PASS

**Step 7: Commit**

```bash
git add components/DesignSystem/Button.vue tests/unit/components/DesignSystem/Button.a11y.spec.ts
git commit -m "fix(a11y): Button — ARIA labels, focus, disabled state"
```

---

### Task 4: DesignSystem/Form/FormInput.vue

**Files:**
- Audit + fix: `components/DesignSystem/Form/FormInput.vue`
- Test: `tests/unit/components/DesignSystem/Form/FormInput.a11y.spec.ts`

**Step 1: Read the component**

Read `components/DesignSystem/Form/FormInput.vue`.

**Step 2: Run a11y-wcag-auditor agent**

Check for:
- `<label>` associated via `for`/`id` or `aria-labelledby`
- Error messages linked via `aria-describedby`
- Required fields marked with `aria-required`
- `autocomplete` attributes set appropriately

**Step 3: Write failing axe test first**

```typescript
// tests/unit/components/DesignSystem/Form/FormInput.a11y.spec.ts
import { describe, it } from 'vitest'
import { mount } from '@vue/test-utils'
import FormInput from '~/components/DesignSystem/Form/FormInput.vue'
import { checkA11y } from '~/tests/unit/helpers/axe'

describe('FormInput a11y', () => {
  it('labeled input has no violations', async () => {
    const wrapper = mount(FormInput, {
      props: { id: 'name', label: 'Full Name', modelValue: '' },
    })
    await checkA11y(wrapper.element)
  })

  it('required input has no violations', async () => {
    const wrapper = mount(FormInput, {
      props: { id: 'email', label: 'Email', modelValue: '', required: true },
    })
    await checkA11y(wrapper.element)
  })

  it('input with error has no violations', async () => {
    const wrapper = mount(FormInput, {
      props: { id: 'email', label: 'Email', modelValue: '', error: 'Invalid email' },
    })
    await checkA11y(wrapper.element)
  })
})
```

**Step 4: Run tests — verify they fail**

Run: `npm test -- tests/unit/components/DesignSystem/Form/FormInput.a11y.spec.ts`

**Step 5: Apply fixes**

**Step 6: Run tests — verify they pass**

Run: `npm test -- tests/unit/components/DesignSystem/Form/FormInput.a11y.spec.ts`
Expected: PASS

**Step 7: Commit**

```bash
git add components/DesignSystem/Form/FormInput.vue tests/unit/components/DesignSystem/Form/FormInput.a11y.spec.ts
git commit -m "fix(a11y): FormInput — labels, aria-describedby for errors, aria-required"
```

---

### Task 5: DesignSystem/Form/FormSelect.vue

Follow the same pattern as Task 4.

**Files:**
- Audit + fix: `components/DesignSystem/Form/FormSelect.vue`
- Test: `tests/unit/components/DesignSystem/Form/FormSelect.a11y.spec.ts`

Key checks: `<label>` association, `aria-required`, error binding via `aria-describedby`, custom select role if not using native `<select>`.

Commit: `fix(a11y): FormSelect — label association, error states`

---

### Task 6: DesignSystem/Form/FormCheckbox.vue

**Files:**
- Audit + fix: `components/DesignSystem/Form/FormCheckbox.vue`
- Test: `tests/unit/components/DesignSystem/Form/FormCheckbox.a11y.spec.ts`

Key checks: checkbox `<label>` association, `aria-checked` if custom, group checkboxes wrapped in `<fieldset>` + `<legend>`.

Commit: `fix(a11y): FormCheckbox — label, fieldset/legend for groups`

---

### Task 7: DesignSystem/Form/FormTextarea.vue

**Files:**
- Audit + fix: `components/DesignSystem/Form/FormTextarea.vue`
- Test: `tests/unit/components/DesignSystem/Form/FormTextarea.a11y.spec.ts`

Key checks: label association, `aria-describedby` for char count/error, `rows` attribute for visible size.

Commit: `fix(a11y): FormTextarea — label, aria-describedby`

---

### Task 8: DesignSystem/Form/FormDateInput.vue + FormTimeInput.vue

**Files:**
- Audit + fix: `components/DesignSystem/Form/FormDateInput.vue`, `FormTimeInput.vue`
- Tests: `tests/unit/components/DesignSystem/Form/FormDateInput.a11y.spec.ts`, `FormTimeInput.a11y.spec.ts`

Key checks: label association, date format hint in `aria-describedby`, keyboard interaction for any custom picker.

Commit: `fix(a11y): FormDateInput/FormTimeInput — labels, date format hints`

---

### Task 9: DesignSystem/Form/FormFileInput.vue + FormButtonGroup.vue

**Files:**
- Audit + fix: both components
- Tests: matching `.a11y.spec.ts` files

Key checks for FileInput: `accept` reflected in label, drag-zone keyboard accessible, upload progress announced.
Key checks for ButtonGroup: `role="group"`, group label via `aria-label` or `aria-labelledby`.

Commit: `fix(a11y): FormFileInput + FormButtonGroup — group roles, upload feedback`

---

### Task 10: DesignSystem/ConfirmDialog.vue

**Files:**
- Audit + fix: `components/DesignSystem/ConfirmDialog.vue`
- Test: `tests/unit/components/DesignSystem/ConfirmDialog.a11y.spec.ts`

Key checks:
- `role="dialog"`, `aria-modal="true"`
- `aria-labelledby` pointing to dialog title
- Focus trapped inside when open
- Focus returns to trigger element on close
- Escape key closes dialog

Commit: `fix(a11y): ConfirmDialog — dialog role, focus trap, Escape key`

---

### Task 11: DesignSystem/Toast.vue

**Files:**
- Audit + fix: `components/DesignSystem/Toast.vue`
- Test: `tests/unit/components/DesignSystem/Toast.a11y.spec.ts`

Key checks:
- `role="status"` or `role="alert"` depending on urgency
- `aria-live="polite"` for info/success, `aria-live="assertive"` for error
- Dismiss button has `aria-label`

Commit: `fix(a11y): Toast — aria-live regions, dismiss button label`

---

### Task 12: DesignSystem/Badge.vue + FilterChips.vue

**Files:**
- Audit + fix: both components
- Tests: matching `.a11y.spec.ts` files

Key checks for Badge: decorative vs. informative badges — informative ones need `aria-label` or visible text.
Key checks for FilterChips: active state announced via `aria-pressed` or `aria-selected`, remove button has `aria-label`.

Commit: `fix(a11y): Badge + FilterChips — informative content labeling`

---

### Task 13: DesignSystem/EmptyState.vue + ErrorState.vue + LoadingState.vue

**Files:**
- Audit + fix: all three components
- Tests: matching `.a11y.spec.ts` files

Key checks:
- Empty/error states use `role="status"` so screen readers announce the state change
- Loading states use `aria-busy="true"` on the container and `aria-live="polite"`
- Icons are decorative (`aria-hidden="true"`)

Commit: `fix(a11y): EmptyState/ErrorState/LoadingState — live regions, aria-busy`

---

## Phase 2: Shared Layout Components — Audit + Fix

### Task 14: SkipLink — extend to all pages

**Files:**
- Read: `components/SkipLink.vue` (component already correct)
- Modify pages missing SkipLink

**Step 1: Find pages missing SkipLink**

Run:
```bash
find pages -name "*.vue" | xargs grep -L "SkipLink" | sort
```

**Step 2: Add SkipLink to each missing page**

Each page that has main content needs:
```html
<SkipLink to="#main-content" text="Skip to main content" />
<main id="main-content">
  <!-- page content -->
</main>
```

Pages that use `layouts/default.vue` only need it in the layout. Add individually to any page that uses a different layout or no layout.

**Step 3: Verify layout already has it**

Read `layouts/default.vue` — confirm SkipLink is present and the main content area has `id="main-content"`.

**Step 4: Commit**

```bash
git add layouts/ pages/
git commit -m "fix(a11y): extend SkipLink to all pages missing it"
```

---

### Task 15: Header + Navigation components

**Files:**
- Audit + fix: `components/Header.vue`, `components/Header/` directory

**Step 1: Read all header/nav components**

Read each file in `components/Header/`.

**Step 2: Run a11y-wcag-auditor agent**

Key checks:
- Main navigation wrapped in `<nav aria-label="Main navigation">`
- Current page indicated with `aria-current="page"`
- Mobile menu toggle has `aria-expanded` + `aria-controls`
- Dropdown menus use `aria-haspopup="true"` on trigger
- User menu has `aria-label`

**Step 3: Apply fixes + write tests**

Test file: `tests/unit/components/Header/Header.a11y.spec.ts`

**Step 4: Commit**

```bash
git commit -m "fix(a11y): Header/Navigation — nav landmark, aria-current, aria-expanded"
```

---

### Task 16: Modal pattern audit

**Files:**
- Audit: all modal components (`EditCoachModal.vue`, `EmailSendModal.vue`, `FamilyInviteModal.vue`, `EmailRecruitingPacketModal.vue`, `TemplateSendModal.vue`, and any in subdirectories)

**Step 1: Find all modal components**

Run:
```bash
find components -name "*Modal*.vue" | sort
```

**Step 2: Audit each modal**

Run `a11y-wcag-auditor` agent on each. Every modal needs:
- `role="dialog"` + `aria-modal="true"`
- `aria-labelledby` → dialog title heading
- Focus trap (Tab cycles within modal, Shift+Tab in reverse)
- Focus returns to trigger on close
- Escape key closes

**Step 3: Apply fixes + commit per modal group**

```bash
git commit -m "fix(a11y): all modals — dialog role, focus trap, aria-labelledby"
```

---

## Phase 3: Pages — Audit + Fix (by domain)

> For each domain, run `a11y-wcag-auditor` agent on each page. Fix all findings. Commit per page or per domain batch. Key page-level checks: one `<h1>` per page, proper heading hierarchy, landmark regions (`<main>`, `<nav>`, `<aside>`, `<footer>`), form labels, link text is descriptive (not "click here").

### Task 17: Auth pages (login, signup, verify-email, recovery)

**Files:** `pages/login.vue`, `pages/signup.vue`, `pages/verify-email.vue`, `pages/recovery/`

Commit: `fix(a11y): auth pages — heading hierarchy, form labels, error announcements`

---

### Task 18: Dashboard page

**Files:** `pages/dashboard.vue`, `components/Dashboard/`

Key: Chart widgets need text alternatives. Status cards need semantic headings. Loading states have `aria-busy`.

Commit: `fix(a11y): dashboard — chart alternatives, heading structure`

---

### Task 19: Schools pages

**Files:** `pages/schools/`, `components/School/`, `components/Schools/`

Key: List items are navigable by keyboard, school card links have descriptive text (not just school name if ambiguous), filter panel is keyboard accessible.

Commit: `fix(a11y): schools pages — list nav, card link labels, filter panel`

---

### Task 20: Coaches pages

**Files:** `pages/coaches/`, `pages/school-[id]-coaches.vue`, `components/Coach/`

Key: Coach cards, coach detail layout, add coach form.

Commit: `fix(a11y): coaches pages — card nav, form labels`

---

### Task 21: Interactions pages

**Files:** `pages/interactions/`, `components/Interaction/`, `components/Interactions/`

Key: Date/time inputs, rich text areas, attachment upload, timeline component.

Commit: `fix(a11y): interactions pages — date inputs, timeline semantics`

---

### Task 22: Settings pages (all sub-pages)

**Files:** `pages/settings/`

Key: Settings forms (player-details, location, notifications, communication-templates, social-sync, family-management, school-preferences, dashboard). Each must have `<fieldset>`/`<legend>` for groups, toggle switches need `role="switch"`.

Commit: `fix(a11y): settings pages — fieldsets, toggle switch roles`

---

### Task 23: Offers + Tasks pages

**Files:** `pages/offers/`, `pages/tasks/`

Key: Offer comparison table needs proper `<th scope>`, sortable columns need `aria-sort`.

Commit: `fix(a11y): offers/tasks pages — table semantics, aria-sort`

---

### Task 24: Onboarding pages

**Files:** `pages/onboarding/`, `components/Onboarding/`

Key: Multi-step form has `aria-current="step"` or a progress indicator with `role="progressbar"`.

Commit: `fix(a11y): onboarding — step progress, multi-step form nav`

---

### Task 25: Remaining pages sweep

**Step 1: Find any unaudited pages**

Run:
```bash
find pages -name "*.vue" | sort
```

Audit any pages not covered in Tasks 17–24.

Commit: `fix(a11y): remaining pages sweep`

---

## Phase 4: Playwright A11y E2E Tests

### Task 26: E2E axe scans for 8 critical flows

**Files:**
- Create: `tests/e2e/a11y/dashboard.a11y.spec.ts`
- Create: `tests/e2e/a11y/schools.a11y.spec.ts`
- Create: `tests/e2e/a11y/coaches.a11y.spec.ts`
- Create: `tests/e2e/a11y/interactions.a11y.spec.ts`
- Create: `tests/e2e/a11y/settings.a11y.spec.ts`
- Create: `tests/e2e/a11y/offers.a11y.spec.ts`
- Create: `tests/e2e/a11y/tasks.a11y.spec.ts`
- Create: `tests/e2e/a11y/login.a11y.spec.ts`

**Step 1: Write the login flow scan (example)**

```typescript
// tests/e2e/a11y/login.a11y.spec.ts
import { test } from '@playwright/test'
import { checkPageA11y } from '../helpers/a11y'

test('login page has no a11y violations', async ({ page }) => {
  await page.goto('/login')
  await page.waitForLoadState('networkidle')
  await checkPageA11y(page)
})
```

**Step 2: Write matching spec for each remaining flow**

Follow same pattern. For authenticated pages, use the existing `authFixture` from `tests/e2e/fixtures/auth.fixture.ts`.

**Step 3: Run E2E tests**

Run: `npm run test:e2e -- tests/e2e/a11y/`
Expected: All PASS (since Phase 1–3 fixes are already applied)

**Step 4: Commit**

```bash
git add tests/e2e/a11y/ tests/e2e/helpers/a11y.ts
git commit -m "test(a11y): Playwright axe scans for 8 critical flows"
```

---

## Phase 5: Final Verification

### Task 27: Full test suite green

**Step 1: Run full unit test suite**

Run: `npm test`
Expected: All existing tests pass + all new a11y tests pass

**Step 2: Run E2E suite**

Run: `npm run test:e2e`
Expected: All pass

**Step 3: Type check**

Run: `npm run type-check`
Expected: No errors

**Step 4: Final commit if needed**

```bash
git commit -m "fix(a11y): final cleanup after full test run"
```

---

## Unresolved Questions

None — design is fully approved and scope is clear. Actual violation details per component will be discovered during audit steps.
