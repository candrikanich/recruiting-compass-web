name: Deploy Staging Manual

on:
  workflow_dispatch:
    branches: [develop]

jobs:
  deploy:
    name: Deploy to Staging
    runs-on: ubuntu-latest
    environment: staging
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: "20"

      - run: npm install -g vercel

      - run: |
          vercel deploy --prod \
            --token="${{ secrets.VERCEL_TOKEN }}" \
            --scope="${{ secrets.VERCEL_ORG_ID }}"
        env:
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID_STAGING }}

      - uses: slackapi/slack-github-action@v2
        if: success()
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            {"text": "✅ Staging deployed", "blocks": [{"type": "section", "text": {"type": "mrkdwn", "text": "*✅ Deployed*\n*Commit:* ${{ github.sha }}"}}]}

      - uses: slackapi/slack-github-action@v2
        if: failure()
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            {"text": "❌ Staging deploy failed", "blocks": [{"type": "section", "text": {"type": "mrkdwn", "text": "*❌ Failed*\n<${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View>"}}]}
